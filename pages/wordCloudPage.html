<div id="wordCloudPage">
    
    <h1 id="wordCloudTitle">Word Cloud Page</h1>
    
    <div id="wordCloud"></div>
	<canvas id="lyricsCloudCanvas" width="600" height="300" style="display:none"></canvas>

    
    <div id="artistSearchBar"></div>
    
    <div class="left">
        
        
        <input type="button" id="search" class="button" value="Search" disabled="true" />
    </div>
    
    <div class="center">
        <input type="button" id="add"  class="button" value="Add" disabled="true" />
    </div>
    
    
    
    
    <div class="right">
        <input type="button" id="share" class="button" value="Share" disabled="true" />
        
        
    </div>
    
</div>


<!--
<style>
    body {
        background-color: gray;
    }

div.relative {
    position: relative;
    width: 40px;
    height: 20px;
    border: 3px solid #73AD21;
}
h1 {
    text-align: center;
    left: 0;
    line-height: 200px;
    margin: auto;
    margin-top: -100px;
    position: absolute;
    top: 30%;
    width: 100%;
}
.button {
    position: relative;
    background-color: purple;
    border: none;
    color: black;
    padding: 13px 25px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
    margin: 4px 2px;
    cursor: pointer;
}


.right {
    text-align: center;
    left: 10;
    line-height: 200px;
    margin: auto;
    margin-top: -100px;
    position: absolute;
    top: 55%;
    width: 120%;
}

.center {
    text-align: center;
    left: 10;
    line-height: 200px;
    margin: auto;
    margin-top: -100px;
    position: absolute;
    top: 55%;
    width: 100%;
}

.left {
    text-align: center;
    left: 10;
    line-height: 200px;
    margin: auto;
    margin-top: -100px;
    position: absolute;
    top: 55%;
    width: 80%;
}

</style>-->

<script>
		
	///
	//FUNCTIONS:
	///		
	
	function generateLyricsCloud() {
		
		// TODO: generate lyrics cloud from 'songs' global var
		// put HTML lyrics cloud in #wordCloud element
		// save lyrics cloud image in case of sharing
		
		$("#wordCloud").html("<a class='wordCloudLink' value='word' style='color:purple'>" + songs[0].lyrics + "</a>"); // temporary
		
		$(".wordCloudLink").click(function() {
			word = $(this).attr("value");
			
			loadPage("songList");
		})
		
		$("#share").removeProp("disabled");
	}
	
	// call this function when the page first loads, then whenever the artist list changes
	function setTitle() {
		// Set the title (of document and header)
		var title = ""
		$.each(artists, function(index, artist) {
			title += ", " + artist.name;
		});
		title = title.substring(2);
		
		document.title = title;
		$("#wordCloudTitle").text(title);
	}
	
	// Call this function when the page first loads and then whenever an artist is searched/added
	function queryArtists(artistsToQuery) {
	
		setTitle();
	
		// TODO: set a good loading animation (like a spinning wheel)
		$("#wordCloud").html("<h3 style='color:red'>Loading...</h3>");
		$("#share").attr("disabled", true);
			
		// Make the parameter object
				
		var ids = [];
		$.each(artistsToQuery, function(key, value) {
			ids.push(value.chartLyricsID);
		})
			
		// Load the lyrics and generate the word cloud
		$.ajax({ // Load artist lyrics
			url: noServer ? "ajax/artistSongs_debug.json" : "ajax/artistSongs.php",
			data: {ids: ids},
			dataType: "json",
			success: function(data) {
				
				// save the results
				$.each(data, function(index, song) {
					songs.push(song);
				})
				
				generateLyricsCloud()
			}
		});
	}
	
	// Call this function when the page first loads and then whenever an artist searched
	function searchArtists(a) {
		
		artists = a;
		songs = [];
		
		queryArtists(a);
	}

	// Call this function whenever an artist is added
	function addArtist(a) {
	
		// Don't add an artist that we already have
		if ($.inArray(a, artists) >= 0) {
			return;
		}
	
		artists.push(a);
		
		queryArtists([a]);
	}
	
	//
	// Post the image to Facebook!
	//
	// @param authToken: the FB authToken to use
	//
	function shareWordCloud(authToken) {
		
		var c = document.getElementById('lyricsCloudCanvas').toDataURL('image/png');
		var encodedPng = c.substring(c.indexOf(',')+1,c.length);
		var imageData = Base64Binary.decode(encodedPng);
		
		var caption = 'I used Lyrics Cloud to make this cloud for the artist(s): ' + $("#wordCloudTitle").text() + "!";
		
		postImageToFacebook(authToken, 'lyricsCloud.png', 'image/png', caption, imageData)
	}
	
	///
	//ON LOAD:
	///
	
	// Initialize the lyrics cloud
	if (songs.length > 0) { // we're coming back to this page
		setTitle();
		generateLyricsCloud();
	} else { // first time to this page
		searchArtists(artists);
	}
	
	// Set up the Artist Search Bar
	$("#artistSearchBar")
		.load("components/artistSearchBar.html")
		.on("yesSelection", function() {

			alert("enable");
		
			$("#search").removeProp("disabled");
			$("#add").removeProp("disabled");
		})
		.on("noSelection", function() {
			$("#search").attr("disabled", true);
			$("#add").attr("disabled", true);
		});

	// Set up the Search Button
	$('#search').click(function() {
		
		$("#artistSearchBar").trigger('clear');
		
		var artistID = $("#artistSearchBar").attr("value");
		searchArtists([allArtists[artistID]]);
	});
	
	// Set up the Add Button
	$('#add').click(function() {
		
		$("#artistSearchBar").trigger('clear');
		
		var artistID = $("#artistSearchBar").attr("value");
		addArtist(allArtists[artistID]);
	});

	
	// Set up the Share Button
	$("#share").click(function() {
				
		FB.getLoginStatus(function(response) { // Check if the user is already logged in
			 			 
			 if (response.status === 'connected') {
				shareWordCloud(response.authResponse.accessToken);
			 } else {
				FB.login(function(response) { // Prompt Facebook login
					FB.getLoginStatus(function(response) { // Check if the user successfully logged in
						 
						 if (response.status === 'connected') {
							shareWordCloud(response.authResponse.accessToken);
						 }
						 
						 // If the user didn't log in, then forget about it!
					});
				}, {scope: 'public_profile,email,publish_actions'});
			}
		});
		
	});
	
	// Draw a placeholder image in the lyrics cloud canvas
	$(function() {
		var c = document.getElementById("lyricsCloudCanvas");
		var ctx = c.getContext("2d");
		ctx.beginPath();
		ctx.arc(95,50,40,0,2*Math.PI);
		ctx.stroke();	
	});
		
</script>
